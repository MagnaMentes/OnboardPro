#!/bin/bash

# Скрипт для автоматического обновления зависимостей в проекте
echo "Обновление зависимостей в проекте OnboardPro Frontend"
echo "=================================================="

# Переходим в директорию frontend
cd "$(dirname "$0")"

# Проверяем наличие обновлений для зависимостей
echo "\n1. Проверка наличия обновлений для зависимостей:\n"
npm outdated

# Обновляем зависимости до последних совместимых версий
echo "\n2. Обновление зависимостей до последних совместимых версий:\n"
npm update

# Обновляем зависимости до последних мажорных версий (с подтверждением)
echo "\n3. Проверка наличия мажорных обновлений:\n"
npm outdated

echo "\nХотите обновить зависимости до последних мажорных версий? (y/n)"
read -r answer
if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
    echo "Обновление до последних мажорных версий..."
    npx npm-check -u
fi

# Проверяем наличие уязвимостей
echo "\n4. Проверка наличия уязвимостей:\n"
npm audit

echo "\nХотите исправить уязвимости? (y/n)"
read -r answer
if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
    echo "Исправление уязвимостей..."
    npm audit fix
    
    echo "\nХотите исправить оставшиеся уязвимости с возможными breaking changes? (y/n)"
    read -r answer
    if [ "$answer" = "y" ] || [ "$answer" = "Y" ]; then
        echo "Исправление уязвимостей с breaking changes..."
        npm audit fix --force
    fi
fi

# Проверяем наличие неиспользуемых зависимостей
echo "\n5. Проверка наличия неиспользуемых зависимостей:\n"
npx depcheck

echo "\n=================================================="
echo "Обновление зависимостей завершено."
echo "Рекомендуется проверить работоспособность приложения после обновления."