# Решение проблем с API v2 в Smart Insights Hub

## Обзор проблемы

На странице Smart Insights Hub возникали ошибки 401 Unauthorized при запросах к API v2, несмотря на корректную авторизацию пользователя.

## Решение

1. **Исправлен сервис AI Insights**:

   - Заменен прямой импорт `axios` на настроенный `api` клиент
   - Исправлен URL для API v2 с `${config.baseURL}/v2/ai` на `/v2/ai`
   - Все методы переведены на использование `api` вместо `axios`

2. **Создана документация**:

   - `/KnowledgeStorage/fixing_api_v2_auth.md` - описание проблемы и решения
   - Обновлены рекомендации по работе с API URL

3. **Разработаны инструменты диагностики**:
   - `diagnose_api_v2.sh` - скрипт для диагностики проблем с API v2
   - `check_smart_insights_hub.sh` - скрипт для проверки работы Smart Insights Hub

## Тестирование

Тестирование показало, что после исправления:

- Запросы к API v2 проходят успешно с корректным JWT токеном
- Данные загружаются и отображаются на странице Smart Insights Hub
- Статистика инсайтов и рекомендаций корректно отображается

## Рекомендации на будущее

1. Всегда использовать настроенный `api` клиент вместо прямого импорта `axios`
2. Следовать рекомендациям по конфигурации API URL из документации
3. При возникновении подобных проблем использовать созданные скрипты диагностики
