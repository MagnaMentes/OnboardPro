# API Онбординга в OnboardPro

## Обзор

API онбординга предоставляет интерфейс для управления программами онбординга, их шагами, назначениями пользователям и отслеживанием прогресса. Система использует REST API с JSON форматом данных.

## Аутентификация

Все API-запросы требуют аутентификации с использованием JWT-токена в заголовке Authorization:

```
Authorization: Bearer <jwt_token>
```

## Программы онбординга

### Получение списка программ

**Запрос**: `GET /api/onboarding/programs/`  
**Доступ**: Все аутентифицированные пользователи  
**Результат**: Список всех программ онбординга

```json
[
  {
    "id": 1,
    "name": "Программа для новых разработчиков",
    "description": "Программа онбординга для новых разработчиков в команде",
    "created_at": "2025-05-21T13:12:14.128374Z",
    "author": 2,
    "author_email": "admin@onboardpro.com",
    "steps": [...]
  }
]
```

### Создание новой программы

**Запрос**: `POST /api/onboarding/programs/`  
**Доступ**: Все аутентифицированные пользователи  
**Тело запроса**:

```json
{
  "name": "Название программы",
  "description": "Описание программы"
}
```

**Результат**: Созданная программа онбординга с присвоенным ID

### Получение информации о программе

**Запрос**: `GET /api/onboarding/programs/{id}/`  
**Доступ**: Все аутентифицированные пользователи  
**Результат**: Детальная информация о программе, включая все шаги

## Шаги онбординга

### Получение списка шагов программы

**Запрос**: `GET /api/onboarding/programs/{program_id}/steps/`  
**Доступ**: Все аутентифицированные пользователи  
**Результат**: Список всех шагов конкретной программы, отсортированный по полю order

### Создание нового шага

**Запрос**: `POST /api/onboarding/programs/{program_id}/steps/`  
**Доступ**: Все аутентифицированные пользователи  
**Тело запроса**:

```json
{
  "name": "Название шага",
  "description": "Описание шага",
  "step_type": "task|meeting|training",
  "is_required": true,
  "deadline_days": 5
}
```

**Результат**: Созданный шаг онбординга с присвоенным ID и автоматически рассчитанным порядковым номером

## Назначения и прогресс

### Назначение программы пользователю

**Запрос**: `POST /api/onboarding/programs/{id}/assign/`  
**Доступ**: HR и администраторы  
**Тело запроса**:

```json
{
  "user_id": 3
}
```

**Результат**: Сообщение об успешном назначении программы

### Получение назначенных программ

**Запрос**: `GET /api/onboarding/assignments/my/`  
**Доступ**: Все аутентифицированные пользователи  
**Результат**: Список программ, назначенных текущему пользователю

```json
[
  {
    "id": 1,
    "user": 3,
    "user_email": "developer@example.com",
    "program": 1,
    "program_name": "Программа для новых разработчиков",
    "assigned_at": "2025-05-21T13:18:22.792804Z",
    "status": "active"
  }
]
```

### Отметка шага как выполненного

**Запрос**: `POST /api/onboarding/steps/{id}/complete/`  
**Доступ**: Пользователь, которому назначена программа, или HR/Admin  
**Тело запроса** (для HR/Admin, если отмечают за другого пользователя):

```json
{
  "user_id": 3
}
```

**Тело запроса** (для пользователя, отмечающего собственный шаг):

```json
{}
```

**Результат**: Сообщение об успешном выполнении шага

### Получение прогресса

**Запрос**: `GET /api/onboarding/assignments/{id}/progress/`  
**Доступ**: Пользователь, которому назначена программа, или HR/Admin  
**Результат**: Детальная информация о прогрессе пользователя по программе

```json
{
  "id": 1,
  "program": 1,
  "program_name": "Программа для новых разработчиков",
  "assigned_at": "2025-05-21T13:18:22.792804Z",
  "status": "completed",
  "total_steps": 3,
  "completed_steps": 3,
  "progress_percentage": 100,
  "steps_progress": [
    {
      "step_id": 1,
      "name": "Знакомство с командой",
      "type": "meeting",
      "order": 1,
      "is_required": true,
      "status": "done",
      "completed_at": "2025-05-21T13:21:39.918110Z"
    }
    // ...другие шаги...
  ]
}
```

## Статусы и коды ответов

- `200 OK` - Запрос выполнен успешно
- `201 Created` - Ресурс успешно создан
- `400 Bad Request` - Некорректные данные в запросе
- `401 Unauthorized` - Отсутствует или недействительный токен аутентификации
- `403 Forbidden` - Недостаточно прав для выполнения операции
- `404 Not Found` - Запрашиваемый ресурс не найден

## Статусы программ и шагов

### Статусы назначения программы (AssignmentStatus)

- `active` - Программа активна и выполняется
- `completed` - Программа завершена (все обязательные шаги выполнены)

### Статусы прогресса шага (ProgressStatus)

- `not_started` - Шаг не начат
- `in_progress` - Шаг в процессе выполнения
- `done` - Шаг выполнен

### Типы шагов (StepType)

- `task` - Задача
- `meeting` - Встреча
- `training` - Обучение
