# Система пользователей и аутентификации (Backend)

## Модель пользователя

Модель пользователя в системе OnboardPro расширяет стандартную модель пользователя Django (`AbstractUser`) и содержит следующие дополнительные поля:

- `email`: Уникальный email-адрес пользователя (используется вместо username для входа)
- `full_name`: Полное имя пользователя
- `position`: Должность пользователя
- `role`: Роль пользователя в системе (см. раздел "Роли пользователей")
- `created_at`: Дата создания пользователя
- `is_active`: Флаг активности пользователя

Важно отметить, что `USERNAME_FIELD` установлен как 'email', что означает, что email используется как основное поле для входа вместо username. Однако, поле `username` все еще требуется для совместимости с админ-панелью Django.

## Роли пользователей

В системе определены следующие роли пользователей:

- `ADMIN`: Администратор системы с полным доступом ко всем функциям
- `HR`: HR-менеджер, отвечающий за процессы найма и онбординга
- `MANAGER`: Менеджер отдела, руководящий сотрудниками
- `EMPLOYEE`: Обычный сотрудник (роль по умолчанию)

Роли реализованы как TextChoices в Django, что обеспечивает проверку валидности и удобство использования:

```python
class UserRole(models.TextChoices):
    ADMIN = 'admin', _('Administrator')
    HR = 'hr', _('HR Manager')
    MANAGER = 'manager', _('Department Manager')
    EMPLOYEE = 'employee', _('Employee')
```

При создании суперпользователя автоматически устанавливается роль `ADMIN`.

## JWT Аутентификация

Для аутентификации используется JWT (JSON Web Tokens) через библиотеку `djangorestframework-simplejwt`. Реализованы следующие эндпоинты:

- `POST /api/auth/login/`: Получение access/refresh токенов при входе
- `POST /api/auth/refresh/`: Обновление access-токена с помощью refresh-токена
- `GET /api/users/me/`: Получение данных текущего аутентифицированного пользователя

### Настройки JWT

JWT токены настроены следующим образом:

- Access token действителен 60 минут
- Refresh token действителен 1 день
- Используется алгоритм HS256 для подписи токенов

## Разрешения (Permissions)

Реализованы базовые разрешения для ролей:

- `IsAdmin`: Доступ только для администраторов
- `IsHR`: Доступ только для HR-менеджеров
- `IsManager`: Доступ только для менеджеров отделов
- `IsAdminOrHR`: Доступ для администраторов и HR-менеджеров
- `IsAdminOrManager`: Доступ для администраторов и менеджеров

## Пользовательский менеджер модели

Реализован кастомный менеджер для модели пользователя (`UserManager`), который обеспечивает:

- Создание обычных пользователей с email в качестве основного идентификатора
- Создание суперпользователей с ролью `ADMIN` по умолчанию
- Нормализацию email для предотвращения дублирования учетных записей

## API и сериализаторы

Для работы с пользователями реализованы следующие компоненты:

- `UserSerializer`: Сериализация данных пользователя для API
- `CustomTokenObtainPairSerializer`: Расширенный сериализатор для JWT токенов, включающий данные пользователя в payload
- `CustomTokenObtainPairView`: Представление для получения JWT токенов
- `CurrentUserView`: Представление для получения данных текущего пользователя
