# Система сбора обратной связи

## Модели

### FeedbackMood

Модель для хранения настроения пользователя по назначенному онбордингу.

- `user`: Ссылка на пользователя (FK)
- `assignment`: Ссылка на назначение онбординга (FK)
- `value`: Значение настроения (enum: great, good, neutral, bad, terrible)
- `comment`: Необязательный комментарий
- `created_at`: Дата и время создания

### StepFeedback

Модель для хранения отзыва пользователя о конкретном шаге онбординга.

- `user`: Ссылка на пользователя (FK)
- `step`: Ссылка на шаг онбординга (FK)
- `assignment`: Ссылка на назначение онбординга (FK)
- `comment`: Текстовый комментарий
- `created_at`: Дата и время создания

## API Endpoints

### POST /api/feedback/mood/

Отправка настроения по назначению.

**Ограничения:**

- Доступен только авторизованным пользователям
- Один пользователь может отправить только один FeedbackMood в день на одно назначение

**Параметры запроса:**

```json
{
  "assignment": 1,
  "value": "good",
  "comment": "Все отлично, но есть небольшие сложности"
}
```

### POST /api/feedback/step/

Отзыв по конкретному шагу.

**Ограничения:**

- Доступен только авторизованным пользователям
- Один комментарий на один шаг (перезаписывает предыдущий)

**Параметры запроса:**

```json
{
  "step": 1,
  "assignment": 1,
  "comment": "Этот шаг очень полезен, но инструкции можно улучшить"
}
```

### GET /api/feedback/assignment/{id}/

Получение всей обратной связи по конкретному назначению.

**Ограничения:**

- Доступен только для HR и ADMIN ролей

**Пример ответа:**

```json
{
  "assignment_id": 1,
  "program_name": "Онбординг разработчика",
  "user_email": "user@example.com",
  "moods": [
    {
      "id": 1,
      "value": "good",
      "value_display": "Good",
      "comment": "Все отлично, но есть небольшие сложности",
      "created_at": "2025-05-21T10:00:00Z"
    }
  ],
  "step_feedbacks": [
    {
      "id": 1,
      "step": 1,
      "step_name": "Знакомство с командой",
      "comment": "Этот шаг очень полезен, но инструкции можно улучшить",
      "created_at": "2025-05-21T11:00:00Z"
    }
  ]
}
```

## Валидации и ограничения

1. **FeedbackMood**:

   - Пользователь может отправить только один отзыв о настроении в день на одно назначение
   - Проверка на уровне сериализатора

2. **StepFeedback**:
   - Шаг должен принадлежать программе назначения
   - Назначение должно принадлежать пользователю
   - Один отзыв на один шаг (перезаписывает предыдущий)
   - Ограничение unique_together на уровне модели

## Разрешения

- POST-запросы доступны всем авторизованным пользователям
- GET /feedback/assignment/{id}/ доступен только HR и ADMIN
