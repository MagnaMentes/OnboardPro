# Аналитика в OnboardPro

В этом документе описана система аналитики данных по онбордингу, реализованная в OnboardPro.

## Общая информация

Аналитическая система OnboardPro предоставляет API для доступа к агрегированным данным по онбордингу сотрудников. Эти данные могут использоваться HR-менеджерами и администраторами для мониторинга процесса адаптации новых сотрудников и оценки эффективности программ онбординга.

### Ограничения доступа

Все аналитические API доступны только для пользователей с ролями:

- `ADMIN` - Администратор системы
- `HR` - HR-менеджер

### Аутентификация

Для доступа к аналитическому API необходимо использовать JWT-токен. Токен можно получить, отправив запрос на `/api/auth/login/` с данными пользователя.

Пример получения токена:

```bash
curl -X POST -H "Content-Type: application/json" -d '{"email": "hr@example.com", "password": "password"}' http://localhost:8000/api/auth/login/
```

Пример использования токена:

```bash
curl -H "Authorization: Bearer <jwt_token>" http://localhost:8000/api/analytics/summary/
```

## API эндпоинты

### 1. Общая сводка

**Endpoint:** `GET /api/analytics/summary/`

**Описание:** Предоставляет общую сводку по онбордингу, включая следующие метрики:

- Количество активных назначений (сотрудников на онбординге)
- Количество завершённых назначений
- Общее количество назначений
- Средний процент прогресса по шагам
- Статистика по фидбеку:
  - Общее количество отметок настроения
  - Общее количество отзывов по шагам
  - Среднее настроение за последние 7 дней (по 5-балльной шкале)
- Статистика по тестам:
  - Общее количество пройденных тестов
  - Количество успешно сданных тестов
  - Процент успешности

**Пример ответа:**

```json
{
  "active_onboarding_count": 15,
  "completed_assignments_count": 25,
  "total_assignments_count": 40,
  "average_progress_percentage": 68.5,
  "feedback": {
    "total_mood_count": 120,
    "total_step_feedback_count": 85,
    "average_mood_last_7_days": 4.2
  },
  "tests": {
    "total_taken": 95,
    "passed": 85,
    "success_rate_percentage": 89.47
  }
}
```

### 2. Таблица назначений

**Endpoint:** `GET /api/analytics/assignments/`

**Описание:** Возвращает таблицу всех назначений с детальной информацией о прогрессе каждого сотрудника.

**Пример ответа:**

```json
[
  {
    "id": 1,
    "full_name": "Иванов Иван Иванович",
    "position": "Frontend-разработчик",
    "program": "Онбординг разработчиков",
    "status": "Активно",
    "progress_percentage": 75.0,
    "assigned_at": "2023-05-10T10:00:00Z"
  },
  {
    "id": 2,
    "full_name": "Петров Петр Петрович",
    "position": "Backend-разработчик",
    "program": "Онбординг разработчиков",
    "status": "Завершено",
    "progress_percentage": 100.0,
    "assigned_at": "2023-04-15T09:00:00Z"
  }
]
```

### 3. Сводка по настроениям

**Endpoint:** `GET /api/analytics/feedback-summary/`

**Описание:** Группирует отзывы по настроению пользователей за последние 14 дней, возвращает данные в формате, удобном для построения графика.

**Пример ответа:**

```json
{
  "days": ["2023-05-14", "2023-05-15", "2023-05-16", "2023-05-17"],
  "great": [3, 5, 2, 4],
  "good": [7, 5, 6, 8],
  "neutral": [2, 3, 5, 2],
  "bad": [1, 0, 2, 1],
  "terrible": [0, 0, 1, 0],
  "total": [13, 13, 16, 15]
}
```

## Расчет показателей

### Процент прогресса

Процент прогресса рассчитывается как отношение количества завершенных шагов к общему количеству шагов в программе:

```
progress_percentage = (completed_steps / total_steps) * 100
```

### Среднее настроение

Для расчета среднего настроения значениям настроения присваиваются числовые значения:

- Great (Отлично) = 5
- Good (Хорошо) = 4
- Neutral (Нейтрально) = 3
- Bad (Плохо) = 2
- Terrible (Ужасно) = 1

Среднее настроение рассчитывается как среднее арифметическое этих значений за указанный период времени.

### Успешность тестов

Процент успешности тестов рассчитывается как отношение количества успешно пройденных тестов к общему количеству пройденных тестов:

```
success_rate_percentage = (passed_tests / total_tests) * 100
```

## Интеграция с Frontend

Данные API могут использоваться для отображения следующих элементов интерфейса:

1. Дашборд с общей статистикой по онбордингу
2. Таблица сотрудников с прогрессом и статусом
3. График динамики настроения сотрудников
4. Графики и диаграммы эффективности обучения
